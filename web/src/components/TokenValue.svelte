<script lang="ts">
	import type { Ethereum } from '../types/ethereum'
	import type { TickerSymbol } from '../types/currency'

	export let token: TickerSymbol
	export let tokenAddress: Ethereum.ContractAddress
	export let tokenIcon: string
	export let tokenName: string
	export let rateInterval: string | undefined

	export let value: number | string | BigInt = '...'
	export let showDecimalPlaces = 3

	export let isDebt = false

	export let showPlainFiat = false
	$: isFiat = showPlainFiat && ['USD', 'EUR', 'GBP', 'CAD', 'INR'].includes(token)

	const formatValue = value => {
		try {
			return new Intl.NumberFormat(globalThis.navigator.languages, {
				... isFiat ? {style: 'currency', currency: token} : {},
				minimumFractionDigits: showDecimalPlaces,
				maximumFractionDigits: showDecimalPlaces
			}).format(value)
		}catch(e){
			console.error(e)
			return value?.toString()
		}
	}
	
	import TokenIcon from './TokenIcon.svelte'
</script>

<style>
	.token-value-container {
		display: inline-grid;
		grid-auto-flow: column;
		justify-content: start;
		align-items: baseline;
		--padding-inner: 0.33em;
		gap: var(--padding-inner);
	}

	.token-value-container > * {
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	.token-value {
		font-weight: 500;
	}

	.token-name, .rate-slash, .rate-interval {
		font-size: 0.8em;
	}

	.is-debt {
		color: var(--down-red);
	}
</style>

<span class="token-value-container" class:is-debt={isDebt} title="{value} {token} ({tokenName})">
	{#if isFiat}
		<span class="token-value">{formatValue(value)}</span>
	{:else}
		<TokenIcon {token} {tokenAddress} {tokenIcon} />
		<span>
			<span class="token-value">{isDebt ? 'âˆ’' : ''}{formatValue(value)}</span>
			<span class="token-name">{token || '___'}</span>{#if rateInterval}<span class="rate-slash">/</span><span class="rate-interval">{rateInterval}</span>{/if}
		</span>
	{/if}
</span>